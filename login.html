<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Dashboard - Login</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@300;400;600;700&family=Crimson+Text:ital@1&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --dark-gold: #B8941E;
            --black: #0A0A0A;
            --off-black: #1A1A1A;
            --charcoal: #2A2A2A;
            --white: #FFFFFF;
            --silver: #C0C0C0;
        }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Oswald', sans-serif;
        background: var(--black);
        color: var(--white);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
    }

    .login-container {
        background: linear-gradient(135deg, var(--off-black) 0%, var(--charcoal) 100%);
        border: 3px solid var(--gold);
        border-radius: 16px;
        padding: 3rem 2rem;
        max-width: 450px;
        width: 100%;
        box-shadow: 
            0 0 0 1px rgba(212, 175, 55, 0.3),
            0 8px 32px rgba(0, 0, 0, 0.8);
    }

    .logo-section {
        text-align: center;
        margin-bottom: 2rem;
    }

    .logo-section img {
        width: 100px;
        height: 100px;
        margin-bottom: 1rem;
        filter: drop-shadow(0 0 12px rgba(212, 175, 55, 0.5));
    }

    .login-title {
        font-family: 'Bebas Neue', cursive;
        font-size: 2rem;
        color: var(--gold);
        text-align: center;
        letter-spacing: 0.15em;
        margin-bottom: 0.5rem;
    }

    .login-subtitle {
        text-align: center;
        font-size: 0.9rem;
        color: var(--silver);
        margin-bottom: 2rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--gold);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .form-input {
        width: 100%;
        padding: 0.875rem 1rem;
        background: var(--black);
        border: 2px solid rgba(212, 175, 55, 0.3);
        border-radius: 8px;
        color: var(--white);
        font-family: 'Oswald', sans-serif;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--gold);
        box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    }

    .form-input::placeholder {
        color: rgba(255, 255, 255, 0.3);
    }

    .login-btn {
        width: 100%;
        padding: 1rem;
        background: linear-gradient(135deg, var(--gold) 0%, var(--dark-gold) 100%);
        border: none;
        border-radius: 8px;
        color: var(--black);
        font-family: 'Oswald', sans-serif;
        font-size: 1rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
    }

    .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
    }

    .login-btn:active {
        transform: translateY(0);
    }

    .error-message {
        background: rgba(231, 76, 60, 0.2);
        border: 1px solid #E74C3C;
        border-radius: 6px;
        padding: 0.75rem;
        margin-bottom: 1.5rem;
        color: #E74C3C;
        font-size: 0.85rem;
        display: none;
    }

    .error-message.show {
        display: block;
    }

    .helper-text {
        text-align: center;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
        margin-top: 1.5rem;
        line-height: 1.5;
    }

    @media (max-width: 520px) {
        .login-container {
            padding: 2rem 1.5rem;
        }

        .login-title {
            font-size: 1.5rem;
        }
    }
</style>

</head>
<body>
    <div class="login-container">
        <div class="logo-section">
            <img src="icon-192.png" alt="Owner Dashboard Logo">
        </div>

    <h1 class="login-title">Owner Dashboard</h1>
    <p class="login-subtitle">Fantasy Football Command Center</p>

    <div id="errorMessage" class="error-message"></div>

    <form id="loginForm">
        <div class="form-group">
            <label class="form-label" for="username">Sleeper Username</label>
            <input 
                type="text" 
                id="username" 
                class="form-input" 
                placeholder="Enter your Sleeper username"
                autocomplete="username"
                required
            >
        </div>

        <div class="form-group">
            <label class="form-label" for="password">Dashboard Password</label>
            <input 
                type="password" 
                id="password" 
                class="form-input" 
                placeholder="Create a secure password"
                autocomplete="current-password"
                required
            >
        </div>

        <button type="submit" class="login-btn">Access Dashboard</button>
    </form>

    <p class="helper-text">
        First time? Enter your Sleeper username and create a password.<br>
        Your credentials are stored securely in your browser.
    </p>
</div>

<script>
    const AUTH_KEY = 'od_auth_v1';
    const errorEl = document.getElementById('errorMessage');
    const loginForm = document.getElementById('loginForm');

    // Simple SHA-256 hash function
    async function hashPassword(password) {
        const encoder = new TextEncoder();
        const data = encoder.encode(password);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function showError(message) {
        errorEl.textContent = message;
        errorEl.classList.add('show');
        setTimeout(() => errorEl.classList.remove('show'), 5000);
    }

    // Check if already logged in
    const existingAuth = localStorage.getItem(AUTH_KEY);
    if (existingAuth) {
        try {
            const auth = JSON.parse(existingAuth);
            if (auth.username && auth.passwordHash) {
                // Already authenticated, redirect to dashboard
                window.location.href = 'index.html';
            }
        } catch (e) {
            // Invalid auth data, clear it
            localStorage.removeItem(AUTH_KEY);
        }
    }

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        if (!username || !password) {
            showError('Please enter both username and password');
            return;
        }

        // Check if this is first-time setup or returning user
        const existingAuth = localStorage.getItem(AUTH_KEY);
        
        if (existingAuth) {
            // Returning user - verify password
            try {
                const auth = JSON.parse(existingAuth);
                const inputHash = await hashPassword(password);

                if (auth.username === username && auth.passwordHash === inputHash) {
                    // Correct credentials
                    window.location.href = 'index.html';
                } else {
                    showError('Incorrect username or password');
                }
            } catch (e) {
                showError('Authentication error. Please try again.');
            }
        } else {
            // First-time setup - validate Sleeper username then create account
            try {
                const loginBtn = document.querySelector('.login-btn');
                loginBtn.textContent = 'Verifying Sleeper username...';
                loginBtn.disabled = true;

                const resp = await fetch(`https://api.sleeper.app/v1/user/${encodeURIComponent(username)}`);
                if (!resp.ok || resp.status === 404) {
                    showError('Sleeper username not found. Please check and try again.');
                    loginBtn.textContent = 'Access Dashboard';
                    loginBtn.disabled = false;
                    return;
                }
                const sleeperUser = await resp.json();
                if (!sleeperUser || !sleeperUser.user_id) {
                    showError('Sleeper username not found. Please check and try again.');
                    loginBtn.textContent = 'Access Dashboard';
                    loginBtn.disabled = false;
                    return;
                }

                const passwordHash = await hashPassword(password);
                const auth = {
                    username: username,
                    passwordHash: passwordHash,
                    createdAt: new Date().toISOString()
                };

                localStorage.setItem(AUTH_KEY, JSON.stringify(auth));
                window.location.href = 'index.html';
            } catch (e) {
                showError('Failed to verify Sleeper username. Check your connection and try again.');
                const loginBtn = document.querySelector('.login-btn');
                loginBtn.textContent = 'Access Dashboard';
                loginBtn.disabled = false;
            }
        }
    });
</script>

</body>
</html>
